<html>
  <head>
    <title>My first Three.js app</title>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
  </head>
  <body>
    <script src="/js/three.min.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script>
      var scene = new THREE.Scene();
      var pieces = 5;
      var aspect = window.innerWidth / window.innerHeight;
      var camera = new THREE.OrthographicCamera( -1, (2 * pieces - 1) * aspect, 2 * pieces - 1, -1, 1, 1000);
      camera.position.x = 2 - pieces;
      camera.position.y = -2 * (pieces + 1);
      camera.position.z = pieces * 2;
      camera.rotation.x = Math.PI / 4;

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      // Create board out of thin squares
      for (var i = 0; i < pieces; i++) {
        for (var j = 0; j < pieces; j++) {
          var box = new THREE.BoxGeometry(2, 2, 0.01, 32);
          if ((i + j) % 2 == 0) {
            var material = new THREE.MeshBasicMaterial({ color: 0xbdbdbd });
          } else {
            var material = new THREE.MeshBasicMaterial({ color: 0x2a2a2a });
          }

          var block = new THREE.Mesh(box, material);
          block.position.x = i * 2;
          block.position.y = j * 2;
          scene.add(block);
        }
      }

      // Place stones from request
      $.get("/json/a", function(data, status) {
        var grid = data.board.grid;
        for (var i = 0; i < grid.length; i++) {
          for (var j = 0; j < grid.length; j++) {
            var cell = grid[i][j].pieces;
            for (var k = 0; k < cell.length; k++) {
              var piece = cell[k];
              if (piece.owner == "One") {
                var material = new THREE.MeshBasicMaterial( { color: 0xff0000 } );
              } else {
                var material = new THREE.MeshBasicMaterial( { color: 0xffffff } );
              }

              if (piece.stone == "Capstone") {
                var mesh = new THREE.SphereGeometry(0.5, 32, 32, 0, Math.PI, 0, Math.PI );
              } else {
                var mesh = new THREE.BoxGeometry(1, 1, 0.25);
              }
              var stone = new THREE.Mesh( mesh, material);

              if (piece.stone == "Standing") {
                stone.rotation.x = Math.PI/2;
                stone.rotation.y = -Math.PI/4;
                stone.position.z = 0.5;
              }
              stone.position.x = 2 * i;
              stone.position.y = 2 * j;
              scene.add(stone);
            }
          }
        }
      });

      var render = function () {
        requestAnimationFrame( render );
        renderer.render(scene, camera);
      };
      render();
    </script>
  </body>
</html>
